# The Boston Drone School - E-Learning Platform
# Comprehensive deployment configuration for integration with thebostondroneschool.org

services:
  # Frontend - Next.js E-Learning Platform
  - type: web
    name: bds-frontend
    rootDir: bds-frontend
    env: node
    buildCommand: "npm ci && npm run build"
    startCommand: "npm start"
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_URL
        value: https://bds-api-node.onrender.com
      - key: NEXT_PUBLIC_SITE_URL
        value: https://bds-frontend.onrender.com
      - key: ANTHROPIC_API_KEY
        sync: false
    plan: starter
    autoDeploy: true

  # Backend API - Node.js/Express
  - type: web
    name: bds-api-node
    rootDir: bds-api-node
    env: node
    buildCommand: "npm ci && npm run build"
    startCommand: "npm run start:safe"
    healthCheckPath: "/api/health"
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        sync: false
      - key: DATABASE_SSL
        value: "true"
      - key: JWT_SECRET
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: CORS_ORIGIN
        value: "https://bds-frontend.onrender.com,https://learn.thebostondroneschool.org,https://thebostondroneschool.org,http://localhost:3000"
    plan: starter
    autoDeploy: true

  # Rust API (Optional - for high-performance operations)
  # Uncomment and configure when ready to deploy the Rust service
  # - type: web
  #   name: bds-rust-api
  #   rootDir: .
  #   env: rust
  #   buildCommand: "cargo build --release"
  #   startCommand: "./target/release/boston_drone_school"
  #   envVars:
  #     - key: DATABASE_URL
  #       fromDatabase:
  #         name: bds-postgres
  #         property: connectionString
  #     - key: ANTHROPIC_API_KEY
  #       sync: false
  #     - key: PORT
  #       value: 10000
  #   plan: starter
  #   autoDeploy: true

# Database configuration
# Note: Database already exists and is managed separately in Render dashboard
# Connection via DATABASE_URL environment variable in backend service